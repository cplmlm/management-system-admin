import{r as n,s as b,t as j,p as k,j as t,R as z,w as L,C as o,S as U,B as w,e as I,x as H,q as T,m as _,y as m,z as q}from"./index-Da2ZG1xd.js";import{r as G,u as J}from"./xlsx-DG2X6oDA.js";import{U as K}from"./index-DfhSQg9d.js";const X=i=>{n.useImperativeHandle(i.onRef,()=>({confirm:C}));const[d,S]=b.useMessage(),[r,N]=n.useState([]),[y,v]=n.useState(""),[c,D]=n.useState(""),[O,A]=n.useState([]),[B]=n.useState([]);n.useEffect(()=>{console.log(window.location),F()},[]);const C=async()=>{if(i.setLoading(!0),r.length==0){d.error("没有需要导入的数据");return}let a=await j(r);(a==null?void 0:a.status)===200&&(d.success(a.message),i.closeModal(1)),i.setLoading(!1)},E={accept:".xls,.xlsx,application/vnd.ms-excel",beforeUpload:a=>{if(c=="")return d.error("请选择学校"),!1;let s=[{}];const l=new FileReader;return l.onload=function(P){var f;const Y=(f=P.target)==null?void 0:f.result,h=G(Y,{type:"binary"});for(const e in h.Sheets)if(h.Sheets.hasOwnProperty(e)){s=J.sheet_to_json(h.Sheets[e]);break}s.forEach(e=>{var x,g,p;if(e.name!==""&&e.name!==null&&e.idNumber!==""&&e.idNumber!==null&&(e.schoolId=y,e.schoolName=c,e.idNumber!==void 0&&e.idNumber!=="")){e.idNumber=e.idNumber.replace(/\s*/g,"");const u=T(e.idNumber);e.gender=u.gender,e.birthdate=_(u.birthDate).format("YYYY-MM-DD"),e.age=u.age,e.createId=(x=m.userInfo)==null?void 0:x.id,e.createBy=(g=m.userInfo)==null?void 0:g.name,e.organizationId=(p=m.userInfo)==null?void 0:p.organizationId}}),N(s)},l.readAsBinaryString(a),!1},fileList:B},F=async a=>{let s=await k(a);(s==null?void 0:s.status)===200&&A(s.data)},M=(a,s)=>{v(a),D(s.name),r.length>0&&r.forEach(l=>{l.schoolId=a,l.schoolName=s.name})},R=[{title:"姓名",dataIndex:"name",align:"center",ellipsis:!0,width:100},{title:"身份证号码",dataIndex:"idNumber",align:"center",fixed:"left",width:200},{title:"出生日期",dataIndex:"birthdate",align:"center",width:100},,{title:"登记年龄",dataIndex:"age",align:"center",width:90},{title:"性别",dataIndex:"gender",align:"center",width:60,render:a=>t.jsx("span",{children:q(a)})},{title:"年级",dataIndex:"grade",align:"center",width:80},{title:"班级",dataIndex:"classGroup",align:"center",width:80},{title:"家庭地址",dataIndex:"address",align:"center",ellipsis:!0,width:200}];return t.jsxs("div",{className:"main-content",children:[S,t.jsx("div",{className:"form-content",children:t.jsxs(z,{className:L.row,align:"middle",children:[t.jsx(o,{span:2,children:"学校名称："}),t.jsx(o,{span:7,children:t.jsx(U,{showSearch:!0,placeholder:"请选择",optionFilterProp:"label",className:"select-width",fieldNames:{label:"name",value:"id"},options:O,value:c,onChange:M})}),t.jsx(o,{span:9}),t.jsx(o,{span:3,children:t.jsx(K,{...E,children:t.jsx(w,{icon:I("ImportOutlined"),type:"primary",children:"导入文件"})})}),t.jsx(o,{span:3,children:t.jsxs(w,{icon:I("ProfileOutlined"),type:"default",children:[" ",t.jsx("a",{download:!0,href:window.location.pathname+"Files/学生信息导入模版.xlsx",children:" 导入模板 "})]})})]})}),t.jsx(H,{columns:R,dataSource:r,footer:()=>t.jsx("span",{style:{color:"#ff0000"},children:"备注：导入前，请下载模板，学生信息按照模板整理好以后，请先选择学校，再上传excel文件，以班级为单位整理成了一个excel文件"}),bordered:!0,scroll:{y:400,x:500},pagination:!1})]})};export{X as default};
